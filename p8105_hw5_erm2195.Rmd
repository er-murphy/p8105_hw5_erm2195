---
title: "P8105 Homework 5"
output: github_document
date: "2023-11-13"
---

## Library and Theme Setup
Loading the `tidyverse` and `broom` libraries for later use.

```{r load_libraries}
library(tidyverse)
library(broom)
```

```{r, include = FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d

```

# Problem 2

## List of Files and Reading CSV Function

First, I'm creating a list of all of the file names of interest called `participant_ids`. Next, I run all of the files listed in `participant_ids` through a function called `read_participant`. This function reads in the csv with the argument filename as a `tibble`, cleans up the names, makes the observations "tidy", and then spits out the data as a dataframe called `participant_data`.

```{r}
participant_ids = 
  list.files(path = "Data/Problem 2/", full.names = FALSE)

read_participant = function(name) {
  
  if (!is.character(name)) {
    stop("Argument x should be a character/string")
  }
  
  filepath = str_c("Data/Problem 2/", name)
  
  participant_data = 
    read_csv(filepath) |> 
    as_tibble() |> 
    janitor::clean_names() |> 
    pivot_longer(
      everything(),
      names_to = "week",
      names_prefix = "week_",
      values_to = "value"
    ) |> 
    mutate(
      week = as.numeric(week),
      value = as.numeric(value)
    )
  
  participant_data
}
  
```

## Combining All Participants Into a Dataframe

With my function to read in the csv files created, I can now move on to combining all participants into a single dataframe. First, I'm creating this single dataframe with the name `all_participants`. One column holds all of the participant ids pulled from the list created above, modified to remove to the file extension. After running each participants through the `read_participant` function and saving the result to a new variable called `summary`, I unnest the summary dataframe for each participant. 

```{r}
all_participants = 
  tibble(
    subject_ID = participant_ids,
    summary = map(participant_ids, read_participant)
  ) |> 
  mutate(
    arm = as.factor(if_else(str_detect(subject_ID, "con"), "Control", "Experimental")),
    subject_ID = str_replace_all(subject_ID, ".csv", "")
  ) |> 
  select(subject_ID, arm, everything()) |> 
  unnest(cols = "summary")
```

subject_ID = as.numeric(str_replace_all(subject_ID, "\\D", ""))

## Plotting Observations by Group

```{r}
ggplot(all_participants, aes(x = week, y = value, group = subject_ID, color = arm)) +
  geom_line(alpha = .5) +
  labs(
    title = "Participant Observation Values Over Time, by Study Arm",
    x = "Week",
    y = "Value",
    color = "Study Arm"
  )
```

From the plot, we can see that participants in the control arm have, on average, lower values than participants in the experimental arm. The difference in values between the study arms is smallest earlier in the study but expands as the weeks progress. By week 7, every single participant in the experimental arm has a higher value than those in the control arm, and this lead further grows in week 8. 

# Problem 3

* Fix n=30
* Fix σ=5

Set μ=0
Generate 5000 datasets from the model

x∼Normal[μ,σ]


For each dataset, save μ̂ 
 and the p-value arising from a test of H:μ=0
 using α=0.05
. Hint: to obtain the estimate and p-value, use broom::tidy to clean the output of t.test.

μ={0,1,2,3,4,5,6}
Generate 5000 datasets from the model

```{r}
n = 30
sigma = 5

sim_power = function(n = 30, sigma = 5, mu) {
  sim_data = tibble(
    x = rnorm(n, mean = mu, sd = sigma)
  )
  
  sim_data = 
    sim_data |> 
    summarize(
      mu_hat = (mean(x))
    )
  
  sim_data
  
}

output = sim_power(mu = 0)

```









